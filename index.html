<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Roteiro — Como Vender um Serviço/Site (10 min)</title>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
  <style>
    :root{
      --bg:#0b0f16;
      --panel:#121827;
      --ink:#f6f7fb;
      --muted:#9aa4b2;
      --accent:#26c6da;
      --accent-2:#69f0ae;
      --danger:#ff5252;
      --warning:#ffa726;
      --success:#66bb6a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 20% 0%, #0f1422 0%, #0b0f16 60%, #0b0f16 100%);
    }

    /* Layout principal */
    .wrap{
      height:100%;
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap:1.2rem;
      padding:1rem clamp(1rem,2vw,2rem);
    }

    /* Topbar com timers e barra de progresso */
    .topbar{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:1rem;
      align-items:center;
    }
    .timers{
      display:flex;
      flex-wrap:wrap;
      gap:0.75rem 1.25rem;
      align-items:baseline;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      font-weight:700;
      letter-spacing:.02em;
      border:1px solid #233047;
      background:linear-gradient(180deg,#131a2a,#0e1523);
      padding:.35rem .7rem;
      border-radius:.6rem;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      color:var(--ink);
    }
    .badge small{color:var(--muted); font-weight:600}
    .bigtime{
      font-variant-numeric: tabular-nums;
      font-size: clamp(1.1rem, 2.2vw, 1.6rem);
    }
    .controls{
      display:flex; gap:.6rem; flex-wrap:wrap;
    }
    button{
      appearance:none; border:0; cursor:pointer;
      padding:.7rem 1rem; border-radius:.8rem;
      font-weight:800; letter-spacing:.02em;
      background: linear-gradient(180deg, #1b2438, #141b2c);
      color:var(--ink);
      border:1px solid #25324a;
      transition: transform .05s ease, opacity .2s ease;
    }
    button:active:not(:disabled){ transform: translateY(1px) }
    button:disabled{ opacity:0.4; cursor:not-allowed }
    .primary{ background: linear-gradient(180deg,#1c2d38,#14242b); border-color:#1e3a4c }
    .ghost{ background:transparent; border-color:#2a3a55 }
    .danger{ background: linear-gradient(180deg,#3a1c20,#2a1216); border-color:#411a1f }

    /* Barras de progresso */
    .bar{
      height:.55rem; border-radius:999px; overflow:hidden;
      background: #101729; border:1px solid #1d2942;
      position:relative;
    }
    .bar > span{
      position:absolute; inset:0 100% 0 0;
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: inset .25s ease;
    }
    .bar.small{ height:.45rem; opacity:.9 }

    /* Área do slide */
    .stage{
      position:relative;
      overflow:hidden;
      border-radius:1.2rem;
      background: linear-gradient(180deg, #0f1423, #0c111d);
      border:1px solid #1e2942;
      box-shadow: 0 10px 40px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.02);
      padding: clamp(1.5rem, 3vw, 2.5rem);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .slide{
      position:absolute; 
      inset:0;
      display:flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: clamp(1.5rem, 3vw, 3rem);
      gap: 1.5rem;
    }
    .slide.hidden{ visibility:hidden; pointer-events:none }
    
    .label{
      position:absolute; 
      top:1.5rem; 
      left:1.5rem;
      color:#c7d2fe; 
      background:#0d1220; 
      border:1px solid #202a44;
      padding:.4rem .8rem; 
      font-weight:800; 
      border-radius:.6rem; 
      letter-spacing:.03em;
      text-transform:uppercase; 
      font-size: clamp(.7rem, 1.5vw, .9rem);
      opacity:.95;
      box-shadow: 0 2px 8px rgba(0,0,0,.3);
    }
    
    .content{
      width: 100%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
    }
    
    .topic{
      text-align:center;
      line-height: 1.15;
      font-size: clamp(1.8rem, 6vw, 4.5rem);
      font-weight: 900;
      letter-spacing: -.025em;
      text-wrap: balance;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.4));
      max-width: 90%;
    }
    
    .sub{
      color:var(--muted);
      font-size: clamp(1rem, 2.2vw, 1.5rem);
      text-align:center;
      line-height: 1.4;
      max-width: 85%;
      text-wrap: balance;
    }
    
    .stats{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      width: 100%;
      max-width: 900px;
      margin-top: 1rem;
    }
    
    .stat-card{
      background: linear-gradient(135deg, #1a2332, #151c2a);
      border: 1px solid #2a3a55;
      border-radius: 1rem;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,.3);
    }
    
    .stat-value{
      font-size: clamp(2rem, 3.5vw, 3rem);
      font-weight: 900;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: .5rem;
    }
    
    .stat-label{
      color: var(--muted);
      font-size: clamp(.85rem, 1.5vw, 1.1rem);
      line-height: 1.3;
    }
    
    .examples{
      background: linear-gradient(135deg, #1a2538, #141d2c);
      border: 1px solid #2a3a55;
      border-radius: 1rem;
      padding: 1.5rem 2rem;
      width: 100%;
      max-width: 800px;
    }
    
    .examples h3{
      color: var(--accent);
      font-size: clamp(1rem, 1.8vw, 1.3rem);
      margin: 0 0 1rem 0;
      text-transform: uppercase;
      letter-spacing: .05em;
      font-weight: 700;
    }
    
    .example-item{
      color: var(--ink);
      padding: .5rem 0;
      border-bottom: 1px solid #1e2a3a;
      font-size: clamp(.9rem, 1.6vw, 1.15rem);
      line-height: 1.5;
    }
    
    .example-item:last-child{
      border-bottom: none;
    }
    
    .example-item strong{
      color: var(--accent-2);
    }
    
    .quote{
      font-style: italic;
      font-size: clamp(1.2rem, 2.5vw, 1.8rem);
      color: var(--ink);
      text-align: center;
      padding: 1.5rem;
      border-left: 4px solid var(--accent);
      background: linear-gradient(90deg, rgba(38,198,218,.05), transparent);
      max-width: 800px;
    }

    /* Rodapé com progresso do tópico */
    .footer{
      display:grid; 
      gap:.6rem;
      grid-template-columns: 1fr auto;
      align-items:center;
    }
    .footer .legend{
      color:var(--muted); 
      font-weight:700; 
      letter-spacing:.02em
    }

    /* Acessibilidade visual extra (borda piscando nos últimos 10s do tópico) */
    .warning{
      animation: blink .9s infinite steps(2, jump-none);
      box-shadow: 0 0 0 3px var(--danger);
    }
    @keyframes blink { 50%{ box-shadow: 0 0 0 3px transparent } }

    /* Seleção e foco */
    ::selection{ background:#1a2a44; color:var(--ink) }
    button:focus-visible{ outline:3px solid #3b82f6; outline-offset:1px }
    
    /* Responsividade para mobile */
    @media (max-width: 768px) {
      .stats {
        grid-template-columns: 1fr;
      }
      .stage {
        padding: clamp(1rem, 2vw, 1.5rem);
      }
      .examples {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <!-- Topo: timers e controles -->
    <div class="topbar">
      <div class="timers">
        <div class="badge">
          <small>Total</small>
          <span class="bigtime" id="totalClock">10:00</span>
        </div>
        <div class="badge">
          <small>Tópico</small>
          <span class="bigtime" id="segmentClock">01:00</span>
        </div>
        <div class="badge">
          <small>Atual</small>
          <span id="currentLabel" class="bigtime">Abertura</span>
        </div>
      </div>
      <div class="controls">
        <button id="startBtn" class="primary">Iniciar</button>
        <button id="pauseBtn" class="ghost" disabled>Pausar</button>
        <button id="prevBtn" class="ghost" disabled>◀︎ Anterior</button>
        <button id="nextBtn" class="ghost" disabled>Próximo ▶︎</button>
        <button id="resetBtn" class="danger" disabled>Reiniciar</button>
        <button id="fsBtn" class="ghost" title="Tela Cheia (F)">Tela cheia</button>
      </div>
      <div class="bar" style="grid-column: 1 / -1;">
        <span id="totalBar"></span>
      </div>
    </div>

    <!-- Palco: dois layers para o efeito de slide -->
    <main class="stage" id="stage" aria-live="polite">
      <div class="slide" id="slideA">
        <!-- Conteúdo será preenchido dinamicamente -->
      </div>
      <div class="slide hidden" id="slideB">
        <!-- Conteúdo será preenchido dinamicamente -->
      </div>
    </main>

    <!-- Rodapé: progresso do tópico -->
    <div class="footer">
      <div class="legend">Progresso do tópico</div>
      <div class="legend" id="topicIndex">1 / 8</div>
      <div class="bar small" style="grid-column: 1 / -1;">
        <span id="segmentBar"></span>
      </div>
    </div>
  </div>

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    // ======= CONFIGURAÇÃO DO ROTEIRO COMPLETO =======
    const slides = [
      {
        label: "Abertura",
        duration: 60,
        content: `
          <div class="content">
            <div class="quote">
              "Ninguém acorda querendo comprar um triturador de frutas; 
              as pessoas acordam querendo uma vida mais saudável."
            </div>
            <div class="sub">— João Apolinário</div>
            <div class="topic" style="margin-top: 2rem;">
              Vamos falar de <strong style="color: var(--accent);">resultados</strong>, 
              não de ferramentas
            </div>
            <div class="sub" style="margin-top: 1rem;">
              5 pontos rápidos sobre como vender soluções
            </div>
          </div>
        `
      },
      {
        label: "Tópico 1 • Soluções",
        duration: 90,
        content: `
          <div class="content">
            <div class="topic">
              Algumas pessoas compram serviços;<br>
              <strong style="color: var(--accent);">muitas pessoas compram soluções</strong>
            </div>
            <div class="stats">
              <div class="stat-card">
                <div class="stat-value">61%</div>
                <div class="stat-label">preferem comprar sem vendedor (rep-free)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">2.8x</div>
                <div class="stat-label">mais chance de compra fácil com buyer enablement</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">3x</div>
                <div class="stat-label">mais chance de acordo maior sem arrependimento</div>
              </div>
            </div>
            <div class="examples">
              <h3>Exemplo prático:</h3>
              <div class="example-item">
                ❌ "Site com 6 páginas e blog"
              </div>
              <div class="example-item">
                ✅ "Captação contínua de orçamentos via formulário + WhatsApp + prova social"
              </div>
            </div>
          </div>
        `
      },
      {
        label: "Tópico 2 • Ouvir",
        duration: 90,
        content: `
          <div class="content">
            <div class="topic">
              O cliente diz muito quando fala<br>
              e quando <strong style="color: var(--accent);">não fala</strong>.<br>
              Então, ouça.
            </div>
            <div class="stats">
              <div class="stat-card">
                <div class="stat-value">43:57</div>
                <div class="stat-label">Proporção ideal falar vs ouvir em vendas</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">44%</div>
                <div class="stat-label">apontam "não entender necessidades" como deal-killer</div>
              </div>
            </div>
            <div class="examples">
              <h3>Perguntas que revelam o não-dito:</h3>
              <div class="example-item">
                "Qual <strong>resultado de negócio</strong> você quer em 90 dias?"
              </div>
              <div class="example-item">
                "O que já tentaram e <strong>não funcionou</strong>?"
              </div>
              <div class="example-item">
                "Quem mais decide e o que essa pessoa <strong>valoriza</strong>?"
              </div>
            </div>
          </div>
        `
      },
      {
        label: "Tópico 3 • Empatia",
        duration: 90,
        content: `
          <div class="content">
            <div class="topic">
              Não seja técnico,<br>
              seja <strong style="color: var(--accent);">empático</strong>
            </div>
            <div class="stats">
              <div class="stat-card">
                <div class="stat-value">80%</div>
                <div class="stat-label">consideram experiência tão importante quanto produto</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">73%</div>
                <div class="stat-label">esperam personalização</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">44%</div>
                <div class="stat-label">escolhem vendedor que demonstra conhecer suas necessidades</div>
              </div>
            </div>
            <div class="examples">
              <h3>Traduzindo técnico → benefício:</h3>
              <div class="example-item">
                ❌ "SSL e páginas leves"
              </div>
              <div class="example-item">
                ✅ "Confiança e mais conversões no mobile"
              </div>
              <div class="example-item">
                ❌ "Integração de CRM"
              </div>
              <div class="example-item">
                ✅ "Nunca mais perder follow-up e resposta mais rápida"
              </div>
            </div>
          </div>
        `
      },
      {
        label: "Tópico 4 • Primeira Impressão",
        duration: 90,
        content: `
          <div class="content">
            <div class="topic">
              Pareça confiante, fale com firmeza,<br>
              pois a <strong style="color: var(--accent);">primeira impressão fica</strong>
            </div>
            <div class="stats">
              <div class="stat-card">
                <div class="stat-value">100ms</div>
                <div class="stat-label">tempo para formar primeira impressão</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">Tom baixo</div>
                <div class="stat-label">julgado como mais competente e confiável</div>
              </div>
            </div>
            <div class="examples">
              <h3>Checklist para os primeiros 60 segundos:</h3>
              <div class="example-item">
                ✓ Postura aberta e confiante
              </div>
              <div class="example-item">
                ✓ Ritmo moderado de fala
              </div>
              <div class="example-item">
                ✓ "Sorriso na voz" (tom amigável)
              </div>
              <div class="example-item">
                ✓ Frase de impacto curta
              </div>
              <div class="example-item">
                ✓ Olhar distribuído pela sala (presencial)
              </div>
            </div>
          </div>
        `
      },
      {
        label: "Tópico 5 • Compromisso",
        duration: 120,
        content: `
          <div class="content">
            <div class="topic">
              Venda o sonho.<br>
              Se comprometa —<br>
              e <strong style="color: var(--danger);">nunca garanta</strong>
            </div>
            <div class="stats">
              <div class="stat-card">
                <div class="stat-value">15 pessoas</div>
                <div class="stat-label">recebem relato de experiência ruim</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">35%</div>
                <div class="stat-label">reduzem gastos após má experiência</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">88%</div>
                <div class="stat-label">recompram com boa experiência</div>
              </div>
            </div>
            <div class="examples">
              <h3>Exemplo de posicionamento correto:</h3>
              <div class="example-item">
                "Meu compromisso é construir e iterar um funil para atingir <strong>X resultado</strong> 
                que faz sentido para o seu negócio, medindo semanalmente [métricas]."
              </div>
              <div class="example-item">
                "Não prometo ranking #1, prometo <strong>processo, transparência e ajustes</strong> 
                até encontrar o que funciona."
              </div>
            </div>
            <div class="sub" style="margin-top: 1rem; color: var(--warning);">
              Comprometa-se com processo, marcos e métricas — não com resultados garantidos
            </div>
          </div>
        `
      },
      {
        label: "Recap",
        duration: 40,
        content: `
          <div class="content">
            <div class="topic">Recapitulando os 5 pontos:</div>
            <div class="examples" style="max-width: 700px;">
              <div class="example-item">
                1️⃣ <strong>Solução > Serviço</strong> — Venda resultados, não ferramentas
              </div>
              <div class="example-item">
                2️⃣ <strong>Ouça mais</strong> — 43% falar, 57% ouvir
              </div>
              <div class="example-item">
                3️⃣ <strong>Empatia > Técnica</strong> — Traduza para benefícios
              </div>
              <div class="example-item">
                4️⃣ <strong>Primeira impressão</strong> — 100ms que definem tudo
              </div>
              <div class="example-item">
                5️⃣ <strong>Compromisso sem garantias</strong> — Processo, não promessas
              </div>
            </div>
          </div>
        `
      },
      {
        label: "Encerramento",
        duration: 20,
        content: `
          <div class="content">
            <div class="topic">
              Qual '<strong style="color: var(--accent);">vida mais saudável</strong>' 
              o seu serviço entrega?
            </div>
            <div class="sub" style="font-size: clamp(1.2rem, 2.5vw, 1.8rem); margin-top: 2rem;">
              Se souber isso, o 'triturador' vira só o meio —<br>
              e a venda acontece.
            </div>
            <div class="topic" style="margin-top: 3rem; color: var(--accent-2);">
              Obrigado! 🚀
            </div>
          </div>
        `
      }
    ];
    // =====================================================================

    // Utilidades
    const totalDuration = slides.reduce((acc, s) => acc + s.duration, 0);
    const pad = n => String(n).padStart(2, "0");
    const fmt = secs => `${pad(Math.floor(secs/60))}:${pad(Math.max(0, Math.floor(secs%60)))}`;

    // Elementos
    const totalClock   = document.getElementById("totalClock");
    const segmentClock = document.getElementById("segmentClock");
    const currentLabel = document.getElementById("currentLabel");
    const totalBar     = document.getElementById("totalBar");
    const segmentBar   = document.getElementById("segmentBar");
    const topicIndexEl = document.getElementById("topicIndex");
    const stage        = document.getElementById("stage");

    // Dois layers para animar entre eles
    const layers = {
      A: document.getElementById("slideA"),
      B: document.getElementById("slideB")
    };
    
    let front = 'A';
    const getBackLayer = () => (front === 'A' ? 'B' : 'A');

    // Estado
    let started = false, paused = false;
    let startTs = 0, pauseTs = 0, pausedAccum = 0;
    let idx = 0;
    let rafId = null;
    let transitionInProgress = false;

    // Controles
    const startBtn = document.getElementById("startBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const nextBtn  = document.getElementById("nextBtn");
    const prevBtn  = document.getElementById("prevBtn");
    const resetBtn = document.getElementById("resetBtn");
    const fsBtn    = document.getElementById("fsBtn");

    function setControls(state){
      if(state === 'idle'){
        startBtn.disabled = false; 
        pauseBtn.disabled = true; 
        nextBtn.disabled = true; 
        prevBtn.disabled = true; 
        resetBtn.disabled = true;
      } else if(state === 'running'){
        startBtn.disabled = true; 
        pauseBtn.disabled = false; 
        nextBtn.disabled = false; 
        prevBtn.disabled = false; 
        resetBtn.disabled = false;
        pauseBtn.textContent = 'Pausar';
      } else if(state === 'paused'){
        startBtn.disabled = true; 
        pauseBtn.disabled = false; 
        nextBtn.disabled = false; 
        prevBtn.disabled = false; 
        resetBtn.disabled = false;
        pauseBtn.textContent = 'Retomar';
      } else if(state === 'finished'){
        startBtn.disabled = true; 
        pauseBtn.disabled = true; 
        nextBtn.disabled = true; 
        prevBtn.disabled = true; 
        resetBtn.disabled = false;
      }
    }

    // Renderiza conteúdo do slide
    function renderSlide(layer, slideData) {
      layer.innerHTML = `
        <div class="label">${slideData.label}</div>
        ${slideData.content}
      `;
    }

    // Inicializa visão do primeiro slide
    function mountInitial(){
      renderSlide(layers.A, slides[0]);
      layers.B.innerHTML = '';
      totalClock.textContent = fmt(totalDuration);
      segmentClock.textContent = fmt(slides[0].duration);
      currentLabel.textContent = slides[0].label;
      topicIndexEl.textContent = `1 / ${slides.length}`;
      totalBar.style.inset = "0 100% 0 0";
      segmentBar.style.inset = "0 100% 0 0";
      stage.classList.remove('warning');
      setControls('idle');
    }

    // Calcula quanto já passou dentro do tópico atual
    function elapsedInCurrent(nowSecs){
      let spent = 0;
      for(let i=0; i<idx; i++){ 
        spent += slides[i].duration; 
      }
      return Math.max(0, nowSecs - spent);
    }

    // Timer + avanço automático
    function tick(){
      if(!started || paused){ 
        return; 
      }

      const now = Date.now();
      const elapsed = Math.floor((now - startTs - pausedAccum)/1000);

      // Total
      const remaining = Math.max(0, totalDuration - elapsed);
      totalClock.textContent = fmt(remaining);
      totalBar.style.inset = `0 ${Math.max(0, 100 - (elapsed/totalDuration)*100)}% 0 0`;

      // Segmento
      const segElapsed = elapsedInCurrent(elapsed);
      const segDur = slides[idx].duration;
      const segRemaining = Math.max(0, segDur - segElapsed);
      segmentClock.textContent = fmt(segRemaining);
      segmentBar.style.inset = `0 ${Math.max(0, 100 - (segElapsed/segDur)*100)}% 0 0`;

      // Sinal visual nos últimos 10s do tópico
      if(segRemaining <= 10 && segRemaining > 0){
        stage.classList.add('warning');
      }else{
        stage.classList.remove('warning');
      }

      // Avança automaticamente quando o segmento acabar
      if(segElapsed >= segDur && idx < slides.length - 1){
        goNext('auto');
      }

      if(elapsed >= totalDuration){
        finish();
        return;
      }

      rafId = requestAnimationFrame(tick);
    }

    // Mostra slide idx no layer de trás e faz animação
    function showSlide(newIdx, direction = 'next'){
      if(transitionInProgress) return;
      transitionInProgress = true;
      
      const incoming = layers[getBackLayer()];
      const outgoing = layers[front];

      renderSlide(incoming, slides[newIdx]);

      // reset posições
      gsap.set(incoming, { xPercent: (direction === 'next' ? 100 : -100), autoAlpha:1 });
      incoming.classList.remove('hidden');
      outgoing.classList.remove('hidden');

      // timeline da transição
      const tl = gsap.timeline({ 
        defaults: { duration: .65, ease: "power3.inOut" },
        onComplete: () => {
          transitionInProgress = false;
        }
      });
      
      tl.to(outgoing, { xPercent: (direction === 'next' ? -100 : 100), autoAlpha:0 }, 0)
        .to(incoming, { xPercent: 0, autoAlpha:1 }, 0)
        .add(() => {
          outgoing.classList.add('hidden');
          front = getBackLayer();
        });

      // Atualiza HUD
      currentLabel.textContent = slides[newIdx].label;
      topicIndexEl.textContent = `${newIdx+1} / ${slides.length}`;
      segmentClock.textContent = fmt(slides[newIdx].duration);
      
      // Recalcula tempo do segmento
      if(started && !paused){
        const now = Date.now();
        const elapsed = Math.floor((now - startTs - pausedAccum)/1000);
        const segElapsed = elapsedInCurrent(elapsed);
        const segDur = slides[newIdx].duration;
        const segRemaining = Math.max(0, segDur - segElapsed);
        segmentClock.textContent = fmt(segRemaining);
        segmentBar.style.inset = `0 ${Math.max(0, 100 - (segElapsed/segDur)*100)}% 0 0`;
      }
    }

    function goNext(reason='manual'){
      if(idx >= slides.length - 1 || transitionInProgress){ 
        return; 
      }
      idx++;
      showSlide(idx, 'next');
    }
    
    function goPrev(){
      if(idx <= 0 || transitionInProgress) return;
      idx--;
      showSlide(idx, 'prev');
    }

    function start(){
      if(started) return;
      started = true;
      paused = false;
      startTs = Date.now();
      pausedAccum = 0;
      idx = 0;
      setControls('running');
      cancelAnimationFrame(rafId);
      rafId = requestAnimationFrame(tick);
    }

    function pauseResume(){
      if(!started) return;
      if(!paused){
        paused = true;
        pauseTs = Date.now();
        setControls('paused');
        cancelAnimationFrame(rafId);
      }else{
        paused = false;
        pausedAccum += (Date.now() - pauseTs);
        setControls('running');
        rafId = requestAnimationFrame(tick);
      }
    }

    function finish(){
      started = false;
      paused = false;
      setControls('finished');
      cancelAnimationFrame(rafId);
      
      const finalContent = {
        label: "Finalizado",
        content: `
          <div class="content">
            <div class="topic" style="color: var(--accent);">
              Apresentação Concluída! 🎯
            </div>
            <div class="sub" style="margin-top: 2rem;">
              Obrigado pela atenção!
            </div>
          </div>
        `
      };
      
      const incoming = layers[getBackLayer()];
      const outgoing = layers[front];
      
      renderSlide(incoming, finalContent);
      
      gsap.set(incoming, { xPercent: 100, autoAlpha:1 });
      incoming.classList.remove('hidden');
      outgoing.classList.remove('hidden');
      
      gsap.timeline({ defaults:{ duration:.65, ease:"power3.inOut" }})
         .to(outgoing, { xPercent: -100, autoAlpha:0 }, 0)
         .to(incoming, { xPercent: 0, autoAlpha:1 }, 0)
         .add(()=>{ 
           outgoing.classList.add('hidden');
           front = getBackLayer(); 
         });
         
      totalClock.textContent = "00:00";
      segmentClock.textContent = "00:00";
      totalBar.style.inset = "0 0 0 0";
      segmentBar.style.inset = "0 0 0 0";
      stage.classList.remove('warning');
    }

    function reset(){
      cancelAnimationFrame(rafId);
      started = false; 
      paused = false; 
      idx = 0; 
      startTs = 0; 
      pauseTs = 0; 
      pausedAccum = 0;
      transitionInProgress = false;
      
      front = 'A';
      layers.A.classList.remove('hidden');
      layers.B.classList.add('hidden');
      gsap.set(layers.A, { xPercent:0, autoAlpha:1 });
      gsap.set(layers.B, { xPercent:100, autoAlpha:0 });
      
      mountInitial();
    }

    // Eventos de UI
    startBtn.addEventListener('click', start);
    pauseBtn.addEventListener('click', pauseResume);
    nextBtn.addEventListener('click', () => goNext());
    prevBtn.addEventListener('click', goPrev);
    resetBtn.addEventListener('click', reset);
    fsBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch((err)=>{
          console.log('Erro ao entrar em tela cheia:', err);
        });
      } else {
        document.exitFullscreen().catch((err)=>{
          console.log('Erro ao sair de tela cheia:', err);
        });
      }
    });

    // Teclas de atalho
    window.addEventListener('keydown', (e)=>{
      if(e.key === ' '){ 
        e.preventDefault(); 
        if(!started){ 
          start(); 
        } else { 
          pauseResume(); 
        }
      }
      if(e.key === 'ArrowRight' && started && !transitionInProgress){ 
        goNext(); 
      }
      if(e.key === 'ArrowLeft' && started && !transitionInProgress){ 
        goPrev(); 
      }
      if(e.key.toLowerCase() === 'f'){ 
        fsBtn.click(); 
      }
      if(e.key.toLowerCase() === 'r' && started){ 
        reset(); 
      }
    });

    // Inicialização
    mountInitial();
  </script>
</body>
</html>
